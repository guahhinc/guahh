<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gemini OS</title>

    <!-- === Add to Home Screen / PWA Meta Tags === -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gemini OS">
    <link rel="apple-touch-icon" href="https://parsefiles.back4app.com/JPaQcFfEEQ1ePBxbf6wvzkPMEqKYHhPYv8boI1Rc/97d2a929575179d968b2e9deee1a7d53_low_res_Settings.png">
    
    <style>
        :root {
            --text-primary: #fff;
            --app-bg-color: #f1f1f1;
            --accent-color: #007aff;
            --animation-curve: cubic-bezier(0.2, 0.8, 0.2, 1);
            --animation-duration: 0.35s;
            --safe-area-top: env(safe-area-inset-top);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            color: var(--text-primary);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .os-container {
            width: 100%;
            height: 100%;
            background-image: linear-gradient(rgba(0,0,0,0.1), rgba(0,0,0,0.1)), url('https://media.idownloadblog.com/wp-content/uploads/2025/06/iOS-26-Wallpaper-by-iSpazio-for-iPhone.jpg');
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            flex-direction: column;
            transition: background-image 0.5s ease-in-out;
        }

        .status-bar { 
            position: relative;
            z-index: 10;
            height: calc(15px + var(--safe-area-top)); /* Empty status bar for spacing */
            flex-shrink: 0;
        }

        .app-grid { 
            flex-grow: 1; 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 5px 10px;
            padding: 10px 20px calc(90px + var(--safe-area-bottom)) 20px;
            overflow-y: auto;
            align-content: start;
        }
        .app-icon { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            text-decoration: none; 
            cursor: pointer;
            padding: 10px 0;
        }
        .app-icon img { width: 70px; height: 70px; transition: transform 0.15s ease-out; }
        .app-icon.pressed img { transform: scale(0.9); }
        .app-icon span { margin-top: 10px; font-size: 14px; text-align: center; text-shadow: 0 1px 3px rgba(0,0,0,0.5); }
        
        @keyframes jiggle { 0% { transform: rotate(-1deg); } 50% { transform: rotate(1deg); } 100% { transform: rotate(-1deg); } }
        .edit-mode .app-icon { animation: jiggle 0.2s infinite; }
        .app-icon.dragging { opacity: 0.5; animation: none; z-index: 1000; }

        .app-window { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; z-index: 100; opacity: 0; pointer-events: none; }
        .app-window.open { opacity: 1; pointer-events: auto; transition: opacity 0.2s ease-in-out 0.15s; }
        .app-header { display: flex; align-items: center; justify-content: center; text-align: center; padding: 15px 20px; background-color: rgba(255,255,255,0.7); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border-bottom: 1px solid rgba(0,0,0,0.1); flex-shrink: 0; color: #000; padding-top: calc(15px + var(--safe-area-top)); }
        .app-header h3 { margin: 0; font-weight: 600; }
        .app-content { flex-grow: 1; overflow: auto; background: var(--app-bg-color); color: #000; }
        #app-launch-animator { position: absolute; background-color: var(--app-bg-color); z-index: 200; pointer-events: none; opacity: 0; border-radius: 18px; transition: all var(--animation-duration) var(--animation-curve); }
        
        #home-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: calc(70px + var(--safe-area-bottom));
            display: flex;
            justify-content: center;
            align-items: flex-start;
            z-index: 210;
            padding-top: 10px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        #home-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        #safari .app-header { padding-top: 10px; padding-bottom: 10px; gap: 10px; display:flex; justify-content: space-between; }
        /* ... other styles */
    </style>
</head>
<body>
    <div class="os-container" id="os-container">
        <div id="app-launch-animator"></div>
        <div class="status-bar"></div>

        <div class="app-grid" id="app-grid">
            <a id="icon-weather" class="app-icon"><img src="https://parsefiles.back4app.com/JPaQcFfEEQ1ePBxbf6wvzkPMEqKYHhPYv8boI1Rc/7b42830afc56112a606dab79e2ecaa35_wyuc2r0Q8D.png" alt="Weather"><span>Weather</span></a>
            <a id="icon-notes" class="app-icon"><img src="https://parsefiles.back4app.com/JPaQcFfEEQ1ePBxbf6wvzkPMEqKYHhPYv8boI1Rc/ddef48e60f637ea32b69a99e057a8db3_low_res_Notes.png" alt="Notes"><span>Notes</span></a>
            <a id="icon-calculator" class="app-icon"><img src="https://parsefiles.back4app.com/JPaQcFfEEQ1ePBxbf6wvzkPMEqKYHhPYv8boI1Rc/f4c0c6c2336b6433aaf11ed6353769d0_low_res_Calculator.png" alt="Calculator"><span>Calculator</span></a>
            <a id="icon-photos" class="app-icon"><img src="https://parsefiles.back4app.com/JPaQcFfEEQ1ePBxbf6wvzkPMEqKYHhPYv8boI1Rc/c0b761fc19488f0b4d2311f29b71ba01_low_res_Photos.png" alt="Photos"><span>Photos</span></a>
            <a id="icon-settings" class="app-icon"><img src="https://parsefiles.back4app.com/JPaQcFfEEQ1ePBxbf6wvzkPMEqKYHhPYv8boI1Rc/97d2a929575179d968b2e9deee1a7d53_low_res_Settings.png" alt="Settings"><span>Settings</span></a>
            <a id="icon-safari" class="app-icon"><img src="https://parsefiles.back4app.com/JPaQcFfEEQ1ePBxbf6wvzkPMEqKYHhPYv8boI1Rc/8204ffaf2c6f9f46a1a803a96c91e7d5_low_res_Safari.png" alt="Safari"><span>Safari</span></a>
            <a id="icon-music" class="app-icon"><img src="https://parsefiles.back4app.com/JPaQcFfEEQ1ePBxbf6wvzkPMEqKYHhPYv8boI1Rc/1e2c520c80078e97af7bd1db0c5c6b8c_low_res_Music.png" alt="Music"><span>Music</span></a>
        </div>
        <div id="home-bar"><div id="home-button"></div></div>
    </div>

    <!-- App Windows -->
    <div id="safari" class="app-window"><div class="app-header" id="safari-header"></div><div class="app-content" id="safari-content"></div></div>
    <div id="music" class="app-window"><div class="app-header"><h3>Music</h3></div><div class="app-content" id="music-content"></div></div>
    <div id="weather" class="app-window"><div class="app-header"><h3>Weather</h3></div><div class="app-content" id="weather-content"></div></div>
    <div id="notes" class="app-window"><div class="app-header"><h3>Notes</h3></div><div class="app-content" id="notes-content"></div></div>
    <div id="calculator" class="app-window"><div class="app-header"><h3>Calculator</h3></div><div class="app-content" id="calculator-content" style="padding:0;"></div></div>
    <div id="photos" class="app-window"><div class="app-header"><h3>Photos</h3></div><div class="app-content" id="photos-content" style="padding:0; background: #fff;"></div></div>
    <div id="settings" class="app-window"><div class="app-header" id="settings-header"><h3>Settings</h3></div><div class="app-content" id="settings-content"></div></div>
    
    <script>
        // --- System State ---
        let currentOpenApp = null;
        let safariInitialized = false;
        let isEditMode = false;
        let longPressTimer;
        let draggedIcon = null;

        // --- System Initializer ---
        document.addEventListener('DOMContentLoaded', () => {
            initClock();
            initWallpaper();
            initHomeButton();
            initAppContent();
            initAppGrid();
        });
        
        // --- App Management ---
        const animator = document.getElementById('app-launch-animator');
        const animationDurationMS = 350;

        function openApp(appId, event) {
            if (isEditMode) return;
            event.preventDefault();
            if (currentOpenApp) return;
            currentOpenApp = appId;
            
            const appWindow = document.getElementById(appId);
            if (appId === 'weather') updateWeather();
            if (appId === 'safari') {
                if(!safariInitialized) {
                    initSafari(); 
                    safariInitialized = true;
                }
                resetSafari(); 
            }

            const icon = event.currentTarget.querySelector('img');
            const iconRect = icon.getBoundingClientRect();
            
            animator.style.transition = 'none';
            animator.style.top = `${iconRect.top}px`;
            animator.style.left = `${iconRect.left}px`;
            animator.style.width = `${iconRect.width}px`;
            animator.style.height = `${iconRect.height}px`;
            animator.style.borderRadius = '18px';
            animator.style.opacity = '1';
            
            appWindow.dataset.originIconId = event.currentTarget.id;

            requestAnimationFrame(() => {
                animator.style.transition = `all ${animationDurationMS}ms var(--animation-curve)`;
                animator.style.top = '0px';
                animator.style.left = '0px';
                animator.style.width = '100vw';
                animator.style.height = '100vh';
                animator.style.borderRadius = '0px';
            });
            
            appWindow.classList.add('open');
            setTimeout(() => animator.style.opacity = '0', animationDurationMS);
        }

        function closeCurrentApp() {
            if (!currentOpenApp) return;
            const appId = currentOpenApp;
            const appWindow = document.getElementById(appId);
            const icon = document.getElementById(appWindow.dataset.originIconId);
            if (!icon) return;
            const iconRect = icon.querySelector('img').getBoundingClientRect();
            
            appWindow.classList.remove('open');
            animator.style.transition = 'none';
            animator.style.top = '0px';
            animator.style.left = '0px';
            animator.style.width = '100vw';
            animator.style.height = '100vh';
            animator.style.borderRadius = '0px';
            animator.style.opacity = '1';
            
            requestAnimationFrame(() => {
                animator.style.transition = `all ${animationDurationMS}ms var(--animation-curve)`;
                animator.style.top = `${iconRect.top}px`;
                animator.style.left = `${iconRect.left}px`;
                animator.style.width = `${iconRect.width}px`;
                animator.style.height = `${iconRect.height}px`;
                animator.style.borderRadius = '18px';
            });

            setTimeout(() => {
                animator.style.opacity = '0';
                currentOpenApp = null;
            }, animationDurationMS);
        }
        
        function initHomeButton() {
            document.getElementById('home-button').addEventListener('click', () => {
                if (isEditMode) {
                    exitEditMode();
                } else if (currentOpenApp) {
                    closeCurrentApp();
                }
            });
        }
        
        // --- Edit Mode & Drag Drop ---
        function enterEditMode() {
            if(currentOpenApp) return;
            isEditMode = true;
            document.getElementById('app-grid').classList.add('edit-mode');
        }
        
        function exitEditMode() {
            isEditMode = false;
            document.getElementById('app-grid').classList.remove('edit-mode');
        }

        function saveIconOrder() {
            const appGrid = document.getElementById('app-grid');
            const iconOrder = Array.from(appGrid.children).map(icon => icon.id);
            localStorage.setItem('geminiOS_iconOrder', JSON.stringify(iconOrder));
        }

        function loadIconOrder() {
            const appGrid = document.getElementById('app-grid');
            const savedOrder = JSON.parse(localStorage.getItem('geminiOS_iconOrder'));
            if (savedOrder) {
                savedOrder.forEach(iconId => {
                    const icon = document.getElementById(iconId);
                    if(icon) appGrid.appendChild(icon);
                });
            }
        }

        function initAppGrid() {
            loadIconOrder();
            const appGrid = document.getElementById('app-grid');
            
            document.querySelectorAll('.app-icon').forEach(icon => {
                const appId = icon.id.replace('icon-', '');
                
                const handlePressStart = (e) => {
                    if (isEditMode) return; 
                    if (e.cancelable) e.preventDefault();
                    icon.classList.add('pressed');
                    clearTimeout(longPressTimer);
                    longPressTimer = setTimeout(() => {
                        enterEditMode();
                        startDrag(icon, e);
                    }, 500);
                };
                const handlePressEnd = () => {
                    clearTimeout(longPressTimer);
                    icon.classList.remove('pressed');
                };

                icon.addEventListener('mousedown', handlePressStart);
                icon.addEventListener('mouseup', handlePressEnd);
                icon.addEventListener('mouseleave', handlePressEnd);
                icon.addEventListener('touchstart', handlePressStart, { passive: false });
                icon.addEventListener('touchend', handlePressEnd);
                icon.addEventListener('touchmove', () => clearTimeout(longPressTimer));

                icon.addEventListener('click', (e) => {
                    if (isEditMode) {
                         e.preventDefault();
                    } else {
                        openApp(appId, e);
                    }
                });
            });

            function startDrag(icon, initialEvent) {
                draggedIcon = icon;
                draggedIcon.classList.add('dragging');

                const handleDragMove = (e) => {
                    e.preventDefault();
                    if (!draggedIcon) return;

                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                    const target = document.elementFromPoint(clientX, clientY);
                    const targetIcon = target ? target.closest('.app-icon') : null;

                    if (targetIcon && targetIcon !== draggedIcon) {
                        const allIcons = [...appGrid.children];
                        const dragIndex = allIcons.indexOf(draggedIcon);
                        const targetIndex = allIcons.indexOf(targetIcon);

                        if (dragIndex < targetIndex) {
                            appGrid.insertBefore(draggedIcon, targetIcon.nextSibling);
                        } else {
                            appGrid.insertBefore(draggedIcon, targetIcon);
                        }
                    }
                };

                const handleDragEnd = () => {
                    if (!draggedIcon) return;
                    draggedIcon.classList.remove('dragging');
                    draggedIcon = null;
                    saveIconOrder();

                    document.removeEventListener('mousemove', handleDragMove);
                    document.removeEventListener('touchmove', handleDragMove);
                    document.removeEventListener('mouseup', handleDragEnd);
                    document.removeEventListener('touchend', handleDragEnd);
                };
                
                document.addEventListener('mousemove', handleDragMove);
                document.addEventListener('touchmove', handleDragMove, { passive: false });
                document.addEventListener('mouseup', handleDragEnd);
                document.addEventListener('touchend', handleDragEnd);
            }
        }


        // --- Core Inits ---
        function initClock() {
            // Clock functionality removed as per request
        }

        function initWallpaper() {
            const savedWallpaper = localStorage.getItem('geminiOS_wallpaper');
            if (savedWallpaper) setWallpaper(savedWallpaper);
        }
        function setWallpaper(url) {
            const fullUrl = `linear-gradient(rgba(0,0,0,0.1), rgba(0,0,0,0.1)), url('${url}')`;
            document.getElementById('os-container').style.backgroundImage = fullUrl;
            localStorage.setItem('geminiOS_wallpaper', url);
        }
        
        // --- App Content & Logic ---
        function initAppContent() {
            document.getElementById('safari-header').innerHTML = `<button id="safari-back" class="safari-nav-btn">‚óÄ</button><button id="safari-forward" class="safari-nav-btn">‚ñ∂</button><div id="url-input-container"><input type="text" id="url-input" placeholder="Enter URL"><button id="safari-reload">‚Üª</button></div>`;
            document.getElementById('safari-content').innerHTML = `<div id="safari-blocked-view" class="blocked-view"><h2>Content Cannot Be Displayed</h2><p>This website does not allow itself to be embedded.</p><button id="blocked-link-opener">Open in New Tab</button></div><iframe id="safari-iframe" sandbox="allow-forms allow-scripts allow-same-origin allow-popups"></iframe>`;
            document.getElementById('music-content').innerHTML = `<div class="music-player"><img src="https://images.unsplash.com/photo-1708915638321-5a9682e05717?q=80&w=800" style="width:200px; height:200px; border-radius:15px;" alt="Album Art"><h2>Liquid Dreams</h2><p>Gemini AI</p><div class="progress-bar"><div id="progress"></div></div><div id="play-pause-btn">‚ñ∂Ô∏è</div></div>`;
            document.getElementById('weather-content').innerHTML = `<div class="weather-display"><h2 id="weather-location">Melbourne</h2><h1 id="weather-temp" style="font-size: 80px; font-weight: 700;">19¬∞</h1><p id="weather-condition">‚òÄÔ∏è Sunny</p></div>`;
            document.getElementById('notes-content').innerHTML = `<textarea id="notes-textarea" style="background:transparent; color:#000; width:100%; height:100%; border:none; resize:none; font-size:16px; padding: 15px;" placeholder="Start typing..."></textarea>`;
            document.getElementById('calculator-content').innerHTML = `<div class="calculator"><div class="calculator-screen" id="calc-display">0</div><button class="calculator-btn" onclick="appendToDisplay('7')">7</button><button class="calculator-btn" onclick="appendToDisplay('8')">8</button><button class="calculator-btn" onclick="appendToDisplay('9')">9</button><button class="calculator-btn operator" onclick="appendToDisplay('/')">√∑</button><button class="calculator-btn" onclick="appendToDisplay('4')">4</button><button class="calculator-btn" onclick="appendToDisplay('5')">5</button><button class="calculator-btn" onclick="appendToDisplay('6')">6</button><button class="calculator-btn operator" onclick="appendToDisplay('*')">√ó</button><button class="calculator-btn" onclick="appendToDisplay('1')">1</button><button class="calculator-btn" onclick="appendToDisplay('2')">2</button><button class="calculator-btn" onclick="appendToDisplay('3')">3</button><button class="calculator-btn operator" onclick="appendToDisplay('-')">-</button><button class="calculator-btn" onclick="appendToDisplay('0')">0</button><button class="calculator-btn" onclick="clearDisplay()">C</button><button class="calculator-btn" onclick="calculateResult()">=</button><button class="calculator-btn operator" onclick="appendToDisplay('+')">+</button></div>`;
            document.getElementById('photos-content').innerHTML = `<div class="photo-grid"><img src="https://images.unsplash.com/photo-1533738363-b7f9aef128ce?q=80&w=400"><img src="https://images.unsplash.com/photo-1574158622682-e40e6984100d?q=80&w=400"><img src="https://images.unsplash.com/photo-1516372583274-f2863ab37145?q=80&w=400"><img src="https://images.unsplash.com/photo-1539278383944-1602a634a8a3?q=80&w=400"><img src="https://images.unsplash.com/photo-1583083527882-3e336b52c853?q=80&w=400"><img src="https://images.unsplash.com/photo-1517423568342-3bce7b6b8084?q=80&w=400"></div>`;
            document.getElementById('settings-content').innerHTML = `<div id="settings-main" class="settings-detail show"><ul class="settings-list"><li>Wi-Fi <span>></span></li><li>Bluetooth <span>></span></li><li onclick="showSettingsDetail('settings-wallpaper')">Wallpaper <span>></span></li><li>General <span>></span></li></ul></div><div id="settings-wallpaper" class="settings-detail"><a href="#" onclick="showSettingsDetail('settings-main')" style="text-decoration:none; color:var(--accent-color); padding:10px 20px; display:block;">&lt; Back</a><div class="wallpaper-grid"><img class="wallpaper-thumb" src="https://media.idownloadblog.com/wp-content/uploads/2025/06/iOS-26-Wallpaper-by-iSpazio-for-iPhone.jpg" onclick="setWallpaper(this.src)"><img class="wallpaper-thumb" src="https://www.iclarified.com/images/news/97554/465546/465546-640.avif" onclick="setWallpaper(this.src)"><img class="wallpaper-thumb" src="https://www.iclarified.com/images/news/97554/466597/466597-640.avif" onclick="setWallpaper(this.src)"><img class="wallpaper-thumb" src="https://www.iclarified.com/images/news/97554/466598/466598-640.avif" onclick="setWallpaper(this.src)"><img class="wallpaper-thumb" src="https://www.iclarified.com/images/news/93874/449380/449380-640.avif" onclick="setWallpaper(this.src)"><img class="wallpaper-thumb" src="https://www.iclarified.com/images/news/93874/449381/449381-640.avif" onclick="setWallpaper(this.src)"><img class="wallpaper-thumb" src="https://www.iclarified.com/images/news/43810/196649/196649-500.avif" onclick="setWallpaper(this.src)"><img class="wallpaper-thumb" src="https://www.iclarified.com/images/news/43810/196664/196664-500.avif" onclick="setWallpaper(this.src)"><img class="wallpaper-thumb" src="https://www.iclarified.com/images/news/43810/196661/196661-500.avif" onclick="setWallpaper(this.src)"><img class="wallpaper-thumb" src="https://www.iclarified.com/images/news/43810/196666/196666-500.avif" onclick="setWallpaper(this.src)"></div></div>`;
            
            const notesTextarea = document.getElementById('notes-textarea');
            notesTextarea.value = localStorage.getItem('notesContent') || '';
            notesTextarea.addEventListener('keyup', () => localStorage.setItem('notesContent', notesTextarea.value));
            document.getElementById('play-pause-btn').addEventListener('click', togglePlay);
        }

        let safariHistory = [];
        let safariHistoryIndex = -1;
        const blockedDomains = ['tiktok.com', 'instagram.com', 'google.com', 'facebook.com', 'youtube.com'];

        function initSafari() {
            const iframe = document.getElementById('safari-iframe');
            const urlInput = document.getElementById('url-input');
            const backBtn = document.getElementById('safari-back');
            const forwardBtn = document.getElementById('safari-forward');
            const reloadBtn = document.getElementById('safari-reload');
            
            iframe.addEventListener('load', () => reloadBtn.classList.remove('loading'));
            backBtn.onclick = () => { if(safariHistoryIndex > 0) { safariHistoryIndex--; loadFromSafariHistory(); } };
            forwardBtn.onclick = () => { if(safariHistoryIndex < safariHistory.length - 1) { safariHistoryIndex++; loadFromSafariHistory(); } };
            reloadBtn.onclick = () => { if (iframe.style.display !== 'none') iframe.contentWindow.location.reload(); };
            urlInput.onkeypress = (e) => e.key === 'Enter' && navigateToSafari(urlInput.value);
        }

        function resetSafari() {
            safariHistory = [];
            safariHistoryIndex = -1;
            navigateToSafari('https://www.wikipedia.org');
        }

        function loadFromSafariHistory() {
            const iframe = document.getElementById('safari-iframe');
            const blockedView = document.getElementById('safari-blocked-view');
            const blockedOpener = document.getElementById('blocked-link-opener');
            const urlInput = document.getElementById('url-input');
            const backBtn = document.getElementById('safari-back');
            const forwardBtn = document.getElementById('safari-forward');

            const url = safariHistory[safariHistoryIndex];
            urlInput.value = url;
            let domain;
            try { domain = new URL(url).hostname.replace('www.', ''); } catch (e) { domain = ''; }

            if (blockedDomains.some(b => domain.includes(b))) {
                iframe.style.display = 'none';
                blockedView.style.display = 'flex';
                blockedOpener.onclick = () => window.open(url, '_blank');
            } else {
                iframe.style.display = 'block';
                blockedView.style.display = 'none';
                iframe.src = url;
            }
            backBtn.disabled = safariHistoryIndex <= 0;
            forwardBtn.disabled = safariHistoryIndex >= safariHistory.length - 1;
        }

        function navigateToSafari(url) {
            if (!url) return;
            if (!/^(https?:\/\/)/.test(url)) url = 'https://' + url;
            if (safariHistory[safariHistoryIndex] === url) return;
            
            document.getElementById('safari-reload').classList.add('loading');
            if (safariHistoryIndex < safariHistory.length - 1) safariHistory = safariHistory.slice(0, safariHistoryIndex + 1);
            safariHistory.push(url);
            safariHistoryIndex++;
            loadFromSafariHistory();
        }

        function showSettingsDetail(detailId) {
            document.querySelectorAll('#settings .settings-detail').forEach(el => el.classList.remove('show'));
            document.getElementById(detailId).classList.add('show');
            document.getElementById('settings-header').querySelector('h3').textContent = detailId === 'settings-main' ? 'Settings' : 'Wallpaper';
        }
        
        window.appendToDisplay = (value) => { let d = document.getElementById('calc-display'); if (d.innerText.length < 15) { d.innerText = (d.innerText === '0' || d.innerText === 'Error') ? value : d.innerText + value; } };
        window.clearDisplay = () => document.getElementById('calc-display').innerText = '0';
        window.calculateResult = () => { let d = document.getElementById('calc-display'); try { const result = eval(d.innerText.replace(/√ó/g, '*').replace(/√∑/g, '/')); d.innerText = parseFloat(result.toFixed(5)); } catch { d.innerText = 'Error'; } };

        window.isPlaying = false;
        window.progressInterval = null;
        function togglePlay() {
            const playPauseBtn = document.getElementById('play-pause-btn');
            const progress = document.getElementById('progress');
            window.isPlaying = !window.isPlaying;
            playPauseBtn.textContent = window.isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
            if (window.isPlaying) {
                window.progressInterval = setInterval(() => {
                    let currentWidth = parseFloat(progress.style.width) || 0;
                    if (currentWidth >= 100) currentWidth = 0;
                    progress.style.width = (currentWidth + 1) + '%';
                }, 500);
            } else {
                clearInterval(window.progressInterval);
            }
        };

        function updateWeather() {
            const melbourneWeather = [ { temp: 19, condition: '‚òÄÔ∏è Sunny' }, { temp: 14, condition: '‚òÅÔ∏è Cloudy' }, { temp: 12, condition: 'üåßÔ∏è Rainy' } ];
            const currentWeather = melbourneWeather[Math.floor(Math.random() * melbourneWeather.length)];
            document.getElementById('weather-temp').textContent = `${currentWeather.temp}¬∞`;
            document.getElementById('weather-condition').textContent = currentWeather.condition;
        }
    </script>
</body>
</html>
